name: Swift
on:
      push:
        branches: [main]
jobs: 
      build:
        runs-on: [macos-latest]
        env: 
          XC_VERSION: ${{ '12.1.0' }}
          XC_PROJECT: ${{ 'GitAction/GitAction.xcworkspace' }}
          XC_SCHEME: ${{ 'GitAction' }}

        steps:  
        - uses: actions/checkout@v2
    
        - name: pr close if test failed
          uses: actions/github-script@v3
          with:
                github-token: ${{secrets.GITHUB_TOKEN}}
                script: |
                    console.log(github)
                    console.log(github.ref)
                    const ref = “${{github.ref}}”
                    const pull_number = Number(ref.split(“/”)[2])
                    await github.pulls.createReview({
                      ...context.repo,
                      pull_number,
                      body: “👋 테스트코드가 실패했습니다.“,
                      event: “REQUEST_CHANGES”
                    })
                    await github.pulls.update({
                      ...context.repo,
                      pull_number,
                      state: “closed”
                    })
